{
  "id": "domain2-gpu-power",
  "title": "GPU Clock and Power Optimization",
  "domain": "domain2",
  "difficulty": "intermediate",
  "description": "Learn how to optimize GPU power settings and clock frequencies for different workloads. Proper power management balances performance, efficiency, and thermal constraints.",
  "learningObjectives": [
    "Query current power and clock settings",
    "Set GPU power limits",
    "Configure application clock frequencies",
    "Understand persistence mode",
    "Optimize for different workload types"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Query Current Power Settings",
      "description": "Check current GPU power consumption and limits.",
      "objectives": [
        "View current power draw",
        "Check power limits",
        "Understand power management state"
      ],
      "expectedCommands": [
        "nvidia-smi -q -d POWER",
        "nvidia-smi --query-gpu=power.draw,power.limit,power.default_limit --format=csv"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must query power settings",
          "expectedCommands": ["nvidia-smi -q -d POWER"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Power Draw = current consumption",
        "Power Limit = enforced maximum",
        "Default Power Limit = factory setting",
        "A100 default: 400W, H100 default: 700W",
        "Power can be limited to reduce thermals"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "GPU Power Management",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Check Clock Frequencies",
      "description": "View current and available GPU clock frequencies.",
      "objectives": [
        "Query current clock speeds",
        "List supported clock frequencies",
        "Understand clock boosting"
      ],
      "expectedCommands": [
        "nvidia-smi -q -d CLOCK",
        "nvidia-smi --query-gpu=clocks.gr,clocks.sm,clocks.mem --format=csv",
        "nvidia-smi -q -d SUPPORTED_CLOCKS"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check clock frequencies",
          "expectedCommands": [
            "nvidia-smi -q -d CLOCK",
            "nvidia-smi -q -d SUPPORTED_CLOCKS"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Graphics clock affects shader performance",
        "Memory clock affects memory bandwidth",
        "Clocks dynamically adjust based on workload",
        "Boost clocks are maximum under load",
        "Supported clocks vary by GPU SKU"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "GPU Clocks",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Enable Persistence Mode",
      "description": "Enable persistence mode to maintain driver state and reduce latency.",
      "objectives": [
        "Check current persistence mode",
        "Understand persistence mode benefits",
        "Enable persistence mode"
      ],
      "expectedCommands": [
        "nvidia-smi -q | grep -i persistence",
        "nvidia-smi -pm 1",
        "nvidia-smi"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must enable persistence mode",
          "expectedCommands": ["nvidia-smi -pm 1", "nvidia-smi"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Persistence mode keeps driver loaded",
        "Reduces CUDA initialization latency",
        "Power settings persist across applications",
        "Required for datacenter deployments",
        "Use nvidia-persistenced service for boot persistence"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Persistence Mode",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Set Power Limit",
      "description": "Configure GPU power limit for thermal or power budget constraints.",
      "objectives": [
        "Understand power limit range",
        "Set custom power limit",
        "Verify new power limit"
      ],
      "expectedCommands": [
        "nvidia-smi -q -d POWER | grep -i limit",
        "nvidia-smi -pl 350 -i 0",
        "nvidia-smi --query-gpu=power.limit --format=csv"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must set power limit",
          "expectedCommands": [
            "nvidia-smi -pl",
            "nvidia-smi --query-gpu=power.limit --format=csv"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Power limit range: Min Power Limit to Max Power Limit",
        "Lower limits reduce thermals and power consumption",
        "May reduce peak performance",
        "Useful for power-constrained environments",
        "Requires root/admin privileges"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Power Limit Configuration",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Configure Application Clocks",
      "description": "Set fixed application clock frequencies for consistent performance.",
      "objectives": [
        "List available application clocks",
        "Set application clocks",
        "Verify clock settings"
      ],
      "expectedCommands": [
        "nvidia-smi -q -d SUPPORTED_CLOCKS | head -50",
        "nvidia-smi -ac 1215,1410 -i 0",
        "nvidia-smi -q -d CLOCK"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must configure application clocks",
          "expectedCommands": ["nvidia-smi -ac", "nvidia-smi -q -d CLOCK"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Format: nvidia-smi -ac <mem_clock>,<graphics_clock>",
        "Must use supported clock combinations",
        "Higher clocks = higher performance but more power",
        "Reset with: nvidia-smi -rac",
        "Application clocks provide consistent performance"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Application Clocks",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Monitor Power and Performance",
      "description": "Monitor power consumption and performance metrics during workload.",
      "objectives": [
        "Enable real-time monitoring",
        "Track power consumption",
        "Correlate power with performance"
      ],
      "expectedCommands": [
        "nvidia-smi dmon -s puc -d 1",
        "nvidia-smi --query-gpu=power.draw,utilization.gpu,temperature.gpu --format=csv -l 1"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must monitor power and performance",
          "expectedCommands": [
            "nvidia-smi dmon",
            "nvidia-smi --query-gpu=power.draw"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "dmon provides device monitoring",
        "-s puc: power, utilization, clocks",
        "-d 1: 1 second interval",
        "Track power vs utilization correlation",
        "Higher utilization = higher power"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "GPU Monitoring",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step7",
      "title": "Optimize for Inference Workloads",
      "description": "Configure power settings optimized for inference workloads.",
      "objectives": [
        "Understand inference power profile",
        "Configure appropriate limits",
        "Balance latency and efficiency"
      ],
      "expectedCommands": ["nvidia-smi -pl 300 -i 0", "nvidia-smi -q -d POWER"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must optimize for inference",
          "expectedCommands": ["nvidia-smi -pl", "nvidia-smi -q -d POWER"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Inference typically uses less power than training",
        "Lower power limits may not impact inference latency",
        "MIG can improve efficiency for small batches",
        "Monitor actual power consumption",
        "Adjust based on latency requirements"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Inference Optimization",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    },
    {
      "id": "step8",
      "title": "Reset to Default Settings",
      "description": "Learn how to reset power and clock settings to defaults.",
      "objectives": [
        "Reset application clocks",
        "Reset power limit",
        "Verify default settings"
      ],
      "expectedCommands": [
        "nvidia-smi -rac",
        "nvidia-smi -pl 400 -i 0",
        "nvidia-smi -q -d POWER"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must reset to defaults",
          "expectedCommands": ["nvidia-smi -rac", "nvidia-smi -q -d POWER"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "-rac resets application clocks",
        "Set power limit to default value",
        "Default Power Limit shown in nvidia-smi -q",
        "Settings may not persist across reboot without persistence mode",
        "Document any custom settings for recovery"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "GPU Settings Reset",
          "url": "https://docs.nvidia.com/datacenter/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Queried current power settings",
    "Checked clock frequencies",
    "Enabled persistence mode",
    "Set custom power limit",
    "Configured application clocks",
    "Monitored power and performance",
    "Understood inference optimization",
    "Reset settings to defaults"
  ],
  "estimatedTime": 44,
  "prerequisites": ["domain1-driver-install"],
  "tags": ["power", "clocks", "optimization", "performance", "intermediate"],
  "tier": 2,
  "commandFamilies": ["gpu-monitoring"],
  "explanationGateId": "gate-domain2-gpu-power"
}
