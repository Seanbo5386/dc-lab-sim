{
  "id": "domain2-mig-setup",
  "title": "Multi-Instance GPU (MIG) Configuration",
  "domain": "domain2",
  "difficulty": "advanced",
  "description": "Learn how to configure Multi-Instance GPU (MIG) technology on NVIDIA H100 GPUs. MIG allows partitioning a single GPU into multiple isolated instances for better resource utilization and isolation in multi-tenant environments.",
  "learningObjectives": [
    "Understand MIG architecture and use cases",
    "Enable MIG mode on H100 GPUs",
    "Create and manage MIG instances with different profiles",
    "Validate MIG instance creation and visibility"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Check MIG Capability and Current Status",
      "description": "Verify that your GPUs support MIG and check whether MIG mode is currently enabled or disabled.",
      "objectives": [
        "Query GPU MIG support",
        "Check current MIG mode status",
        "Understand MIG mode requirements"
      ],
      "expectedCommands": [
        "nvidia-smi --query-gpu=mig.mode.current,mig.mode.pending --format=csv",
        "nvidia-smi -mig -lgip"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check MIG status",
          "expectedCommands": [
            "nvidia-smi --query-gpu=mig.mode",
            "nvidia-smi -q"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi -q' and look for 'MIG Mode' section",
        "MIG is supported on A100, A30, and H100 GPUs",
        "Use 'nvidia-smi --query-gpu=mig.mode.current,mig.mode.pending --format=csv' for structured output",
        "MIG mode changes require a GPU reset to take effect"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "NVIDIA MIG User Guide",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Enable MIG Mode",
      "description": "Enable MIG mode on the target GPU. This requires setting MIG mode and performing a GPU reset for the change to take effect.",
      "objectives": [
        "Enable MIG mode on GPU 0",
        "Understand the GPU reset requirement",
        "Verify MIG mode is enabled after reset"
      ],
      "expectedCommands": [
        "nvidia-smi -i 0 -mig 1",
        "nvidia-smi --gpu-reset -i 0"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must enable MIG mode",
          "expectedCommands": [
            "nvidia-smi -i 0 -mig 1",
            "nvidia-smi -mig 1",
            "nvidia-smi --gpu-reset -i 0"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi -i 0 -mig 1' to enable MIG on GPU 0",
        "The change sets 'mig.mode.pending' but requires reset",
        "Use 'nvidia-smi --gpu-reset -i 0' to reset the GPU",
        "WARNING: GPU reset will terminate any running processes on that GPU",
        "After reset, verify with 'nvidia-smi --query-gpu=mig.mode.current --format=csv'"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "MIG Mode Configuration",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "List Available MIG Profiles",
      "description": "Query the available MIG GPU Instance Profiles and Compute Instance Profiles. Different profiles provide different resource allocations (memory, compute slices, encoders).",
      "objectives": [
        "List all available GPU Instance Profiles",
        "Understand profile naming (e.g., 1g.5gb, 3g.20gb)",
        "Learn resource allocation for each profile"
      ],
      "expectedCommands": ["nvidia-smi mig -lgip", "nvidia-smi mig -lcip"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must list GPU Instance Profiles",
          "expectedCommands": ["nvidia-smi mig -lgip"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi mig -lgip' to list GPU Instance Profiles",
        "Use 'nvidia-smi mig -lcip' to list Compute Instance Profiles",
        "Profile naming: <slices>g.<memory>gb (e.g., 1g.5gb = 1 slice, 5GB memory)",
        "H100 80GB supports profiles like: 1g.10gb, 2g.20gb, 3g.40gb, 4g.40gb, 7g.79gb",
        "Not all profile combinations can be created simultaneously"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "MIG Profile Reference",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Create MIG GPU Instances",
      "description": "Create one or more MIG GPU Instances on the GPU using specific profiles. GPU Instances partition the GPU's memory and compute resources.",
      "objectives": [
        "Create a GPU Instance with 1g.10gb profile",
        "Verify GPU Instance creation",
        "List all created GPU Instances"
      ],
      "expectedCommands": [
        "nvidia-smi mig -cgi 1g.10gb -C",
        "nvidia-smi mig -lgi"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must create MIG GPU Instance",
          "expectedCommands": ["nvidia-smi mig -cgi"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi mig -cgi <profile>' to create GPU Instance",
        "Use '-C' flag to also create a default Compute Instance",
        "Use 'nvidia-smi mig -lgi' to list all GPU Instances",
        "Each GPU Instance gets a unique ID and UUID",
        "You can create multiple instances with different profiles until GPU resources are exhausted"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Creating MIG Instances",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Verify MIG Instance Creation",
      "description": "Confirm that MIG instances were created successfully and are visible to the system.",
      "objectives": [
        "List all GPU Instances",
        "List all Compute Instances",
        "Verify instance IDs and UUIDs"
      ],
      "expectedCommands": ["nvidia-smi mig -lgi", "nvidia-smi mig -lci"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must list GPU and Compute Instances",
          "expectedCommands": ["nvidia-smi mig -lgi", "nvidia-smi mig -lci"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi mig -lgi' to list all GPU Instances",
        "Use 'nvidia-smi mig -lci' to list all Compute Instances",
        "If you used '-C' flag during GPU Instance creation, Compute Instance is auto-created",
        "Each Compute Instance gets a unique CI ID",
        "Compute Instances are what CUDA applications actually use"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "MIG Compute Instances",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Verify MIG Device Visibility",
      "description": "Confirm that MIG devices are visible to CUDA applications and can be targeted using CUDA_VISIBLE_DEVICES.",
      "objectives": [
        "List MIG devices visible to nvidia-smi",
        "Understand MIG device UUID format",
        "Learn how to target specific MIG devices"
      ],
      "expectedCommands": [
        "nvidia-smi -L",
        "nvidia-smi --query-gpu=name,uuid --format=csv"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must list MIG devices",
          "expectedCommands": ["nvidia-smi -L"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi -L' to list all GPU and MIG devices",
        "MIG devices appear as: 'MIG 1g.10gb Device X'",
        "Each MIG device has a unique UUID starting with 'MIG-'",
        "Use CUDA_VISIBLE_DEVICES=<MIG-UUID> to target specific MIG device",
        "Can also use device ordinals: 0, 1, 2, etc. for MIG devices"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Targeting MIG Devices",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    },
    {
      "id": "step7",
      "title": "Understand MIG Isolation Guarantees",
      "description": "Learn about the isolation guarantees provided by MIG and how different instances are protected from each other.",
      "objectives": [
        "Understand MIG memory isolation",
        "Understand MIG compute isolation",
        "Understand MIG error isolation",
        "Review QoS guarantees"
      ],
      "expectedCommands": ["nvidia-smi mig -lgi", "nvidia-smi -q -i 0"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must review MIG configuration",
          "expectedCommands": ["nvidia-smi mig -lgi", "nvidia-smi -q"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "MIG provides memory isolation: each instance has dedicated DRAM",
        "MIG provides compute isolation: SMs are partitioned between instances",
        "MIG provides fault isolation: errors in one instance don't affect others",
        "Quality of Service (QoS): guaranteed compute bandwidth per instance",
        "Note: No L2 cache or memory bandwidth isolation on H100",
        "Each MIG instance operates independently"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "MIG Isolation Features",
          "url": "https://docs.nvidia.com/datacenter/tesla/mig-user-guide/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Successfully verified MIG capability on GPUs",
    "Enabled MIG mode and performed GPU reset",
    "Listed all available MIG profiles",
    "Created at least one GPU Instance",
    "Created Compute Instances for GPU Instances",
    "Verified MIG device visibility",
    "Understood MIG isolation guarantees"
  ],
  "estimatedTime": 40,
  "prerequisites": ["domain1-driver-install"],
  "tags": ["mig", "multi-instance-gpu", "partitioning", "h100", "advanced"],
  "tier": 3,
  "commandFamilies": ["gpu-monitoring"],
  "explanationGateId": "gate-domain2-mig-setup",
  "toolHints": false
}
