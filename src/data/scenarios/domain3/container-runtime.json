{
  "id": "domain3-containers",
  "title": "GPU-Enabled Container Runtime Setup",
  "domain": "domain3",
  "difficulty": "intermediate",
  "description": "Learn how to configure and use GPU-enabled container runtimes (Docker with NVIDIA Container Toolkit and Enroot) for running AI workloads in containers. Containerization is essential for reproducible, portable AI deployments.",
  "learningObjectives": [
    "Understand GPU container runtime architecture",
    "Configure NVIDIA Container Toolkit for Docker",
    "Run GPU-enabled containers with Docker",
    "Use Enroot for HPC container management",
    "Pull and run containers from NVIDIA NGC"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Verify Docker Installation",
      "description": "Check that Docker is installed and the Docker daemon is running. Verify your user has permission to run Docker commands.",
      "objectives": [
        "Check Docker version",
        "Verify Docker daemon is running",
        "Test basic Docker functionality",
        "Check user Docker permissions"
      ],
      "expectedCommands": ["docker --version", "docker ps", "docker info"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify Docker installation",
          "expectedCommands": ["docker --version", "docker ps", "docker info"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'docker --version' to check installation",
        "Use 'docker ps' to list running containers (tests daemon connectivity)",
        "If 'docker ps' fails with permission error, user needs to be in 'docker' group",
        "Use 'docker info' to see detailed daemon information",
        "Verify 'Runtimes' section in 'docker info' includes 'nvidia'"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Docker Documentation",
          "url": "https://docs.docker.com/"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Verify NVIDIA Container Toolkit",
      "description": "Confirm that NVIDIA Container Toolkit (formerly nvidia-docker2) is installed and Docker can access GPUs.",
      "objectives": [
        "Check NVIDIA Container Toolkit installation",
        "Verify 'nvidia' runtime is available",
        "Test GPU visibility from container"
      ],
      "expectedCommands": [
        "docker info | grep -i runtime",
        "docker run --rm --gpus all nvidia/cuda:12.4.0-base nvidia-smi"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify NVIDIA Container Toolkit",
          "expectedCommands": ["docker info", "docker run --rm --gpus"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'docker info | grep -i runtime' to see available runtimes",
        "Should see 'nvidia' in the Runtimes list",
        "Test with: 'docker run --rm --gpus all nvidia/cuda:12.4.0-base nvidia-smi'",
        "This command runs nvidia-smi inside a container to verify GPU access",
        "--gpus all exposes all GPUs to the container",
        "Container should see all host GPUs in nvidia-smi output"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "NVIDIA Container Toolkit",
          "url": "https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Pull NVIDIA NGC Container Images",
      "description": "Learn how to browse and pull container images from NVIDIA NGC (NVIDIA GPU Cloud) catalog. NGC provides optimized containers for AI frameworks.",
      "objectives": [
        "Understand NGC catalog structure",
        "Pull a PyTorch container from NGC",
        "Verify image is downloaded",
        "Understand image tags and versions"
      ],
      "expectedCommands": [
        "docker pull nvcr.io/nvidia/pytorch:24.01-py3",
        "docker images"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must pull NGC container",
          "expectedCommands": [
            "docker pull nvcr.io/nvidia/pytorch",
            "docker images"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "NGC registry: nvcr.io/nvidia/<framework>:<tag>",
        "Example: nvcr.io/nvidia/pytorch:24.01-py3",
        "Use 'docker pull' to download images",
        "Use 'docker images' to list local images",
        "NGC containers are optimized for NVIDIA GPUs with latest versions",
        "Tags include year.month (e.g., 24.01 = January 2024)",
        "Browse available images at: https://catalog.ngc.nvidia.com"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "NVIDIA NGC Catalog",
          "url": "https://catalog.ngc.nvidia.com"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Run GPU-Enabled Container",
      "description": "Launch a container with GPU access and run a simple GPU workload inside it to verify functionality.",
      "objectives": [
        "Start container with GPU access",
        "Execute commands inside container",
        "Verify GPU visibility",
        "Understand GPU selection options"
      ],
      "expectedCommands": [
        "docker run --rm --gpus all nvcr.io/nvidia/pytorch:24.01-py3 nvidia-smi",
        "docker run --rm --gpus device=0 nvcr.io/nvidia/pytorch:24.01-py3 nvidia-smi"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must run GPU container",
          "expectedCommands": ["docker run --rm --gpus"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use '--gpus all' to expose all GPUs",
        "Use '--gpus device=0,1' to expose specific GPUs",
        "Use '--rm' flag to auto-remove container after exit",
        "Use '-it' flags for interactive terminal",
        "Example: 'docker run -it --gpus all --rm nvcr.io/nvidia/pytorch:24.01-py3 bash'",
        "From inside container, run 'nvidia-smi' to verify GPU access"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Docker GPU Access",
          "url": "https://docs.docker.com/config/containers/resource_constraints/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Configure NGC CLI",
      "description": "Set up NVIDIA NGC CLI tool for programmatic access to NGC catalog and container registry.",
      "objectives": [
        "Verify NGC CLI installation",
        "Configure NGC API key",
        "Test NGC CLI functionality",
        "Browse NGC catalog via CLI"
      ],
      "expectedCommands": [
        "ngc config set",
        "ngc registry image list nvcr.io/nvidia/pytorch"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must configure NGC CLI",
          "expectedCommands": ["ngc config", "ngc registry image list"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "NGC CLI requires an API key from ngc.nvidia.com",
        "Use 'ngc config set' to configure API key",
        "Use 'ngc registry image list <repo>' to browse images",
        "Use 'ngc registry image pull <image>' to download images",
        "NGC CLI can also download models, datasets, and resources",
        "API key can be generated at: https://ngc.nvidia.com/setup/api-key"
      ],
      "estimatedDuration": 6,
      "documentationLinks": [
        {
          "title": "NGC CLI Documentation",
          "url": "https://ngc.nvidia.com/setup/installers/cli"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Introduction to Enroot",
      "description": "Learn about Enroot, a lightweight container runtime designed for HPC environments and Slurm integration.",
      "objectives": [
        "Understand Enroot vs Docker differences",
        "Import a container image with Enroot",
        "Create and start Enroot containers",
        "Understand Enroot's unprivileged model"
      ],
      "expectedCommands": [
        "enroot import docker://nvcr.io/nvidia/pytorch:24.01-py3",
        "enroot create nvcr.io+nvidia+pytorch+24.01-py3.sqsh",
        "enroot list"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must use Enroot",
          "expectedCommands": ["enroot import", "enroot create", "enroot list"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Enroot is designed for HPC: unprivileged, no daemon required",
        "Use 'enroot import docker://<image>' to import from Docker registry",
        "Images are stored as .sqsh (SquashFS) files",
        "Use 'enroot create <image.sqsh>' to create a container",
        "Use 'enroot start <container>' to run the container",
        "Enroot integrates natively with Slurm via pyxis plugin",
        "GPUs are automatically available in Enroot containers"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "Enroot Documentation",
          "url": "https://github.com/NVIDIA/enroot"
        }
      ]
    }
  ],
  "successCriteria": [
    "Verified Docker installation and GPU runtime",
    "Confirmed NVIDIA Container Toolkit functionality",
    "Successfully pulled NGC container images",
    "Ran GPU-enabled containers with Docker",
    "Configured NGC CLI tool",
    "Used Enroot to create and run containers"
  ],
  "estimatedTime": 40,
  "prerequisites": ["domain1-driver-install"],
  "tags": [
    "docker",
    "containers",
    "nvidia-container-toolkit",
    "enroot",
    "ngc",
    "intermediate"
  ],
  "tier": 2,
  "commandFamilies": ["container-tools"],
  "explanationGateId": "gate-domain3-containers"
}
