{
  "id": "domain3-storage",
  "title": "HPC Storage System Validation",
  "domain": "domain3",
  "difficulty": "intermediate",
  "description": "Learn how to validate and monitor storage systems in HPC environments, including NFS, Lustre parallel filesystems, and local storage. Understanding storage configuration and capacity is critical for AI/ML workloads that require high-throughput data access.",
  "learningObjectives": [
    "Understand HPC storage architecture and filesystem types",
    "Monitor storage capacity and usage with df command",
    "Identify mounted filesystems and their configurations",
    "Work with Lustre parallel filesystem utilities",
    "Validate storage connectivity and performance"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Check Local and Network Storage",
      "description": "Use the df command to check disk space usage across all mounted filesystems. This includes local storage, NFS mounts, and parallel filesystems like Lustre.",
      "objectives": [
        "View filesystem disk usage",
        "Identify different storage types",
        "Check available capacity",
        "Understand usage patterns"
      ],
      "expectedCommands": ["df -h", "df -hT"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check disk space usage",
          "expectedCommands": ["df -h", "df -hT"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'df -h' to show disk usage in human-readable format (GB, TB)",
        "Use 'df -hT' to also show filesystem types (ext4, nfs4, lustre)",
        "Look for the main filesystems: / (root), /home (user data), /data (datasets), /scratch (temporary)",
        "/scratch is typically a high-performance parallel filesystem (Lustre) for AI workloads",
        "Check 'Use%' column to identify filesystems approaching capacity",
        "NFS mounts show as 'nas01:/data' or similar in the 'Filesystem' column"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "df Command Manual",
          "url": "https://man7.org/linux/man-pages/man1/df.1.html"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Check Inode Usage",
      "description": "Verify inode usage on filesystems. Inodes can be exhausted even when disk space is available, especially with many small files common in AI datasets.",
      "objectives": [
        "Understand inode concept",
        "Check inode usage across filesystems",
        "Identify potential inode exhaustion",
        "Differentiate between disk space and inode limits"
      ],
      "expectedCommands": ["df -i", "df -ih"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check inode usage",
          "expectedCommands": ["df -i"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'df -i' to show inode usage instead of disk space",
        "Each file/directory consumes one inode",
        "AI datasets with millions of small files can exhaust inodes",
        "Look at 'IUse%' column - high percentage indicates many files",
        "Lustre filesystems typically have very high inode counts",
        "If IUse% approaches 100%, filesystem cannot create new files even with free space"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Understanding Inodes",
          "url": "https://www.kernel.org/doc/html/latest/filesystems/ext4/overview.html"
        }
      ]
    },
    {
      "id": "step3",
      "title": "View Mounted Filesystems",
      "description": "Use the mount command to see all mounted filesystems, their mount options, and filesystem types. This helps understand the storage topology.",
      "objectives": [
        "List all mounted filesystems",
        "Understand mount options",
        "Identify filesystem types",
        "Verify NFS and Lustre mounts"
      ],
      "expectedCommands": ["mount"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must view mounted filesystems",
          "expectedCommands": ["mount"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'mount' with no arguments to show all mounts",
        "Look for NFS mounts: 'nas01:/data on /data type nfs4'",
        "Look for Lustre mounts: 'lustre@tcp:/scratch on /scratch type lustre'",
        "Mount options are shown in parentheses: (rw,relatime,...)",
        "'rw' = read-write, 'ro' = read-only",
        "NFS options like 'rsize' and 'wsize' affect performance",
        "Lustre options like 'flock' enable file locking"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "mount Command Manual",
          "url": "https://man7.org/linux/man-pages/man8/mount.8.html"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Check Lustre Filesystem Status",
      "description": "Use the lfs (Lustre File System) utility to check Lustre-specific information. Lustre is a parallel filesystem commonly used in HPC for high-throughput workloads.",
      "objectives": [
        "Understand Lustre architecture (MDT, OST)",
        "Check Lustre disk usage",
        "Verify OST (Object Storage Target) balance",
        "Understand Lustre filesystem capacity"
      ],
      "expectedCommands": ["lfs df -h", "lfs df"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check Lustre status",
          "expectedCommands": ["lfs df"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Note: lfs commands only work if Lustre filesystem is installed",
        "Check if Lustre is available: 'which lfs' or 'mount | grep lustre'",
        "If Lustre not available, skip this step and use standard df commands",
        "Use 'lfs df -h' to show Lustre filesystem usage (if available)",
        "Lustre components: MDT (metadata), OST (data storage)",
        "Multiple OSTs provide parallel I/O throughput",
        "Check if OSTs are balanced - uneven usage indicates striping issues",
        "Total filesystem capacity = sum of all OST capacities",
        "Each OST typically represents a separate RAID array",
        "Lustre striping distributes files across OSTs for parallel access"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Lustre Operations Manual",
          "url": "https://doc.lustre.org/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Verify Lustre Server Connectivity",
      "description": "Check that all Lustre servers (MDTs and OSTs) are online and responding. This is critical for ensuring storage reliability.",
      "objectives": [
        "Check Lustre server health",
        "Verify MDT and OST connectivity",
        "Identify offline storage targets",
        "Understand Lustre high availability"
      ],
      "expectedCommands": ["lfs check servers"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify Lustre servers",
          "expectedCommands": ["lfs check servers"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'lfs check servers' to verify all Lustre targets",
        "Should see response from each MDT and OST",
        "'All Lustre servers are responding' indicates healthy system",
        "If any OST is offline, filesystem is degraded (but may still function)",
        "Degraded filesystem has reduced performance and redundancy",
        "In production, offline OSTs require immediate attention",
        "Lustre supports failover for high availability configurations"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Lustre Administration",
          "url": "https://doc.lustre.org/lustre_manual.xhtml"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Storage Capacity Planning",
      "description": "Analyze storage usage patterns and plan for capacity needs. AI/ML workloads often require massive storage for datasets and checkpoints.",
      "objectives": [
        "Calculate available storage capacity",
        "Identify storage bottlenecks",
        "Understand storage requirements for AI workloads",
        "Plan for storage expansion"
      ],
      "expectedCommands": ["df -h", "lfs df -h"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must analyze storage capacity",
          "expectedCommands": ["df -h", "lfs df"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Compare usage across different filesystem types",
        "/scratch (Lustre) should have most available space for training data",
        "/home is typically smaller, for user files and code",
        "/data (NFS) is for shared datasets and long-term storage",
        "AI workloads need 3-5x model size for: model, checkpoints, optimizer states",
        "Large language models: 70B parameters ~140GB, need ~700GB with checkpoints",
        "Image datasets: ImageNet ~150GB, LAION-400M ~1.5TB",
        "Plan for 20-30% free space buffer for filesystem performance",
        "Lustre performance degrades when >80% full"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "HPC Storage Best Practices",
          "url": "https://www.nvidia.com/en-us/data-center/dgx-superpod/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Checked disk space usage with df command",
    "Verified inode usage across filesystems",
    "Viewed all mounted filesystems",
    "Examined Lustre filesystem status",
    "Confirmed all Lustre servers are responding",
    "Analyzed storage capacity for AI workloads"
  ],
  "estimatedTime": 35,
  "prerequisites": ["domain1-driver-install"],
  "tags": [
    "storage",
    "lustre",
    "nfs",
    "filesystem",
    "df",
    "lfs",
    "intermediate"
  ],
  "tier": 2,
  "commandFamilies": ["cluster-tools"],
  "explanationGateId": "gate-domain3-storage"
}
