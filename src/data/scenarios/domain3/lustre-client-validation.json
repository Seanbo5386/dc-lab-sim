{
  "id": "domain3-lustre-validation",
  "title": "Lustre Client Configuration and Validation",
  "domain": "domain3",
  "difficulty": "intermediate",
  "description": "Learn how to configure and validate Lustre parallel filesystem clients on DGX nodes. Lustre provides high-performance storage for AI training workloads.",
  "learningObjectives": [
    "Understand Lustre architecture",
    "Mount Lustre filesystem",
    "Validate client configuration",
    "Test filesystem performance",
    "Troubleshoot Lustre issues"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Understand Lustre Architecture",
      "description": "Learn the components of a Lustre parallel filesystem.",
      "objectives": [
        "Understand MGS/MDT/OST roles",
        "Know Lustre network requirements",
        "Learn client-server model"
      ],
      "expectedCommands": [
        "lctl get_param version",
        "modinfo lustre | head -10"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must understand Lustre architecture",
          "expectedCommands": ["lctl get_param version", "modinfo lustre"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "MGS: Management Server (config)",
        "MDT: Metadata Target (files/dirs)",
        "OST: Object Storage Target (data)",
        "Client mounts from MGS",
        "LNet provides networking"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Lustre Architecture",
          "url": "https://wiki.lustre.org/Main_Page"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Verify Lustre Client Installation",
      "description": "Check that Lustre client software is properly installed.",
      "objectives": [
        "Check Lustre module",
        "Verify client version",
        "Check LNet configuration"
      ],
      "expectedCommands": [
        "lsmod | grep lustre",
        "lctl get_param version",
        "lnetctl net show"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify Lustre installation",
          "expectedCommands": ["lsmod | grep lustre", "lctl get_param version"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Lustre kernel module must be loaded",
        "Version should match server version",
        "LNet configures network transport",
        "Check for lnet, ksocklnd, ko2iblnd modules",
        "InfiniBand typically used for HPC"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Lustre Client",
          "url": "https://wiki.lustre.org/Client"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Configure LNet Networking",
      "description": "Set up Lustre networking for optimal performance.",
      "objectives": [
        "Configure LNet interfaces",
        "Verify network connectivity",
        "Test LNet routing"
      ],
      "expectedCommands": [
        "lnetctl net show",
        "lctl ping <mgs_nid>",
        "cat /etc/lnet.conf"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must configure LNet",
          "expectedCommands": ["lnetctl net show", "lctl ping"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "LNet over InfiniBand: o2ib",
        "LNet over TCP: tcp",
        "NID format: IP@transport (e.g., 10.0.0.1@o2ib)",
        "lctl ping tests connectivity",
        "Configure in /etc/lnet.conf or /etc/modprobe.d/"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "LNet Configuration",
          "url": "https://wiki.lustre.org/LNet"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Mount Lustre Filesystem",
      "description": "Mount the Lustre filesystem on the client.",
      "objectives": [
        "Create mount point",
        "Mount filesystem",
        "Verify mount options"
      ],
      "expectedCommands": [
        "mkdir -p /lustre",
        "mount -t lustre <mgs_nid>:/<fsname> /lustre",
        "df -h /lustre"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must mount Lustre filesystem",
          "expectedCommands": [
            "mkdir -p /lustre",
            "mount -t lustre",
            "df -h /lustre"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Mount syntax: mount -t lustre mgs:/fsname /mountpoint",
        "Use fstab for persistent mount",
        "Mount options: flock, user_xattr, noatime",
        "Check mount with df or lfs df",
        "MGS NID from administrator"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "Mounting Lustre",
          "url": "https://wiki.lustre.org/Mounting_a_Lustre_File_System"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Verify Filesystem Layout",
      "description": "Check Lustre filesystem layout and stripe configuration.",
      "objectives": [
        "View filesystem info",
        "Check stripe settings",
        "Understand MDT/OST layout"
      ],
      "expectedCommands": [
        "lfs df -h /lustre",
        "lfs getstripe /lustre",
        "lctl get_param llite.*.max_cached_mb"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must verify filesystem layout",
          "expectedCommands": ["lfs df -h /lustre", "lfs getstripe /lustre"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "lfs df shows OST usage",
        "lfs getstripe shows file striping",
        "Stripe count affects parallelism",
        "Stripe size affects I/O pattern",
        "max_cached_mb controls client cache"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "lfs Command",
          "url": "https://wiki.lustre.org/lfs"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Test Filesystem Performance",
      "description": "Validate Lustre performance meets requirements.",
      "objectives": [
        "Run simple I/O test",
        "Check write performance",
        "Check read performance"
      ],
      "expectedCommands": [
        "dd if=/dev/zero of=/lustre/testfile bs=1M count=1024 oflag=direct",
        "dd if=/lustre/testfile of=/dev/null bs=1M iflag=direct",
        "rm /lustre/testfile"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must test filesystem performance",
          "expectedCommands": ["dd if=/dev/zero of=/lustre", "dd if=/lustre"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use oflag=direct for unbuffered I/O",
        "Expected: 1-10+ GB/s depending on config",
        "Parallel I/O tools: IOR, mdtest",
        "Stripe across OSTs for throughput",
        "Monitor with lctl get_param osc.*.stats"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Lustre Performance",
          "url": "https://wiki.lustre.org/Lustre_Tuning"
        }
      ]
    },
    {
      "id": "step7",
      "title": "Configure Striping for AI Workloads",
      "description": "Optimize stripe configuration for AI training data.",
      "objectives": [
        "Set stripe count",
        "Configure stripe size",
        "Create optimized directories"
      ],
      "expectedCommands": [
        "lfs setstripe -c -1 -S 4M /lustre/training_data",
        "lfs getstripe /lustre/training_data",
        "lfs quota -u $USER /lustre"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must configure striping",
          "expectedCommands": ["lfs setstripe", "lfs getstripe", "lfs quota"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "-c -1 stripes across all OSTs",
        "-S 4M sets 4MB stripe size",
        "Large files benefit from more stripes",
        "Small files use fewer stripes",
        "Checkpoint directories need good write performance"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Striping Best Practices",
          "url": "https://wiki.lustre.org/Configuring_Lustre_File_Striping"
        }
      ]
    },
    {
      "id": "step8",
      "title": "Troubleshoot Lustre Issues",
      "description": "Debug common Lustre client problems.",
      "objectives": [
        "Check client health",
        "Review Lustre logs",
        "Diagnose connectivity issues"
      ],
      "expectedCommands": [
        "lctl get_param llite.*.stats | head -30",
        "dmesg | grep -i lustre | tail -20",
        "lctl set_param debug=+info"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must troubleshoot Lustre",
          "expectedCommands": [
            "lctl get_param llite",
            "dmesg | grep -i lustre"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Check client stats for errors",
        "dmesg shows Lustre messages",
        "lctl debug for detailed logging",
        "Network issues often cause hangs",
        "Check server availability with lctl ping"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Lustre Troubleshooting",
          "url": "https://wiki.lustre.org/Lustre_Debugging"
        }
      ]
    }
  ],
  "successCriteria": [
    "Understood Lustre architecture",
    "Verified Lustre client installation",
    "Configured LNet networking",
    "Mounted Lustre filesystem",
    "Verified filesystem layout",
    "Tested filesystem performance",
    "Configured AI workload striping",
    "Troubleshot Lustre issues"
  ],
  "estimatedTime": 48,
  "prerequisites": ["domain3-storage-validation"],
  "tags": [
    "lustre",
    "storage",
    "parallel-filesystem",
    "performance",
    "intermediate"
  ],
  "tier": 2,
  "commandFamilies": ["cluster-tools"],
  "explanationGateId": "gate-domain3-lustre-validation"
}
