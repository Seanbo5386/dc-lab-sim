{
  "id": "domain3-dcgm-policy",
  "title": "Configure DCGM Monitoring Policies",
  "domain": "domain3",
  "difficulty": "intermediate",
  "description": "Set up DCGM policies for automated GPU health monitoring and alerting. Policies can automatically respond to ECC errors, thermal events, and other GPU issues.",
  "learningObjectives": [
    "Create DCGM GPU groups",
    "Configure health watch policies",
    "Set ECC error thresholds",
    "Verify policy activation"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Create GPU Group",
      "description": "Create a DCGM group containing the GPUs you want to monitor. Groups allow you to apply policies to multiple GPUs at once.",
      "objectives": ["Create a named GPU group"],
      "expectedCommands": ["dcgmi group -c", "dcgmi group -l"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Create or list groups",
          "expectedCommands": ["dcgmi group"],
          "requireAllCommands": true
        }
      ],
      "hints": ["Use dcgmi group -c to create a new group"],
      "enhancedHints": [
        {
          "id": "step1-hint1",
          "level": 2,
          "message": "Try: dcgmi group -c allgpus",
          "trigger": { "type": "time-based", "timeSeconds": 45 }
        },
        {
          "id": "step1-hint2",
          "level": 3,
          "message": "After creating, use 'dcgmi group -l' to list all groups and their IDs",
          "trigger": { "type": "time-based", "timeSeconds": 75 }
        }
      ],
      "estimatedDuration": 3,
      "documentationLinks": [
        {
          "title": "DCGM Group Management",
          "url": "https://docs.nvidia.com/datacenter/dcgm/latest/user-guide/getting-started.html"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Add GPUs to Group",
      "description": "Add specific GPUs to your monitoring group using their GPU IDs.",
      "objectives": ["Add GPUs to the group"],
      "expectedCommands": ["dcgmi group -g 1 -a"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Add GPUs to group",
          "expectedCommands": ["dcgmi group"],
          "requireAllCommands": true
        }
      ],
      "hints": ["Use -a flag to add GPUs, -g to specify group ID"],
      "enhancedHints": [
        {
          "id": "step2-hint1",
          "level": 2,
          "message": "Try: dcgmi group -g 1 -a 0,1,2,3 to add GPUs 0-3 to group 1",
          "trigger": { "type": "time-based", "timeSeconds": 45 }
        }
      ],
      "estimatedDuration": 2
    },
    {
      "id": "step3",
      "title": "Configure Health Watch Policies",
      "description": "Set up health monitoring policies for the GPU group. Policies monitor for specific conditions like ECC errors, thermal issues, and power violations.",
      "objectives": ["Enable health watches"],
      "expectedCommands": ["dcgmi policy --set", "dcgmi policy --get"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Configure policy",
          "expectedCommands": ["dcgmi policy"],
          "requireAllCommands": true
        }
      ],
      "hints": ["dcgmi policy --set enables monitoring policies"],
      "enhancedHints": [
        {
          "id": "step3-hint1",
          "level": 2,
          "message": "Try: dcgmi policy --set -g 1 -e",
          "trigger": { "type": "time-based", "timeSeconds": 45 }
        },
        {
          "id": "step3-hint2",
          "level": 3,
          "message": "Policy flags: -e (ECC), -p (PCIe), -m (memory), -P (power), -t (thermal)",
          "trigger": { "type": "time-based", "timeSeconds": 90 }
        }
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "DCGM Policy Management",
          "url": "https://docs.nvidia.com/datacenter/dcgm/latest/user-guide/feature-overview.html"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Verify Policy Configuration",
      "description": "Confirm the policies are active and monitoring the GPU group.",
      "objectives": ["Verify policies are enabled"],
      "expectedCommands": ["dcgmi policy --get", "dcgmi health -c"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Check policy status",
          "expectedCommands": ["dcgmi policy --get"],
          "requireAllCommands": true
        },
        {
          "type": "output-match",
          "description": "Policy should show enabled",
          "outputPattern": "Enabled|enabled|Active"
        }
      ],
      "hints": ["Use --get to view current policy settings"],
      "enhancedHints": [
        {
          "id": "step4-hint1",
          "level": 2,
          "message": "Run 'dcgmi policy --get -g 1' to see all policies for group 1",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step5",
      "title": "Test Policy with Health Check",
      "description": "Run a health check to verify policies are working and detecting GPU status correctly.",
      "objectives": ["Verify health monitoring works"],
      "expectedCommands": ["dcgmi health -c", "dcgmi health -g 1 -c"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Run health check",
          "expectedCommands": ["dcgmi health"],
          "requireAllCommands": true
        }
      ],
      "hints": ["dcgmi health -c runs a comprehensive health check"],
      "estimatedDuration": 2
    }
  ],
  "successCriteria": [
    "Created GPU monitoring group",
    "Added GPUs to the group",
    "Configured health watch policies",
    "Verified policy activation",
    "Ran health check successfully"
  ],
  "estimatedTime": 15,
  "prerequisites": [],
  "tags": [
    "dcgm",
    "policy",
    "monitoring",
    "health",
    "configuration",
    "intermediate",
    "domain3"
  ],
  "tier": 2,
  "commandFamilies": ["diagnostics"],
  "explanationGateId": "gate-domain3-dcgm-policy"
}
