{
  "id": "domain3-slurm-gres",
  "title": "Configure Slurm GRES for GPU Scheduling",
  "domain": "domain3",
  "difficulty": "intermediate",
  "description": "Learn to configure Slurm Generic Resources (GRES) for proper GPU job scheduling. This is essential for multi-GPU workloads in HPC environments.",
  "learningObjectives": [
    "Understand GRES configuration syntax",
    "Configure GPU resources in slurm.conf",
    "Verify GRES is properly detected",
    "Submit jobs requesting specific GPU counts"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Check Current Slurm Configuration",
      "description": "First, examine the current Slurm configuration to understand the baseline GRES settings.",
      "objectives": ["View current GRES configuration"],
      "expectedCommands": ["scontrol show config", "scontrol show nodes"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "View Slurm configuration",
          "expectedCommands": ["scontrol show config"],
          "requireAllCommands": false
        }
      ],
      "hints": ["Use scontrol to view the current configuration"],
      "enhancedHints": [
        {
          "id": "step1-hint1",
          "level": 1,
          "message": "The scontrol command can show you Slurm's configuration",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step1-hint2",
          "level": 2,
          "message": "Try: scontrol show config | grep -i gres",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3,
      "documentationLinks": [
        {
          "title": "Slurm GRES Documentation",
          "url": "https://slurm.schedmd.com/gres.html"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Verify GPU Detection",
      "description": "Confirm that Slurm detects the GPUs on each node. The GRES configuration should show gpu:8 for DGX nodes.",
      "objectives": ["Verify GPU count matches hardware"],
      "expectedCommands": ["sinfo -o '%n %G'", "scontrol show node dgx-00"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Check node GRES",
          "expectedCommands": ["sinfo", "scontrol show node"],
          "requireAllCommands": false
        },
        {
          "type": "output-match",
          "description": "Verify GPU count shown",
          "outputPattern": "gpu:[0-9]+"
        }
      ],
      "hints": ["sinfo can show GRES with custom format"],
      "enhancedHints": [
        {
          "id": "step2-hint1",
          "level": 2,
          "message": "Try: sinfo -o '%n %G' to show node names and GRES",
          "trigger": { "type": "time-based", "timeSeconds": 45 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step3",
      "title": "Submit GPU Job",
      "description": "Submit a test job requesting GPU resources using the --gres flag.",
      "objectives": ["Successfully submit a job with GPU GRES request"],
      "expectedCommands": ["sbatch --gres=gpu:2"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Submit job with GPU request",
          "expectedCommands": ["sbatch"],
          "requireAllCommands": true
        }
      ],
      "hints": ["Use --gres=gpu:N to request N GPUs"],
      "enhancedHints": [
        {
          "id": "step3-hint1",
          "level": 1,
          "message": "The --gres flag specifies generic resources",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        },
        {
          "id": "step3-hint2",
          "level": 3,
          "message": "Example: sbatch --gres=gpu:2 --wrap='nvidia-smi'",
          "trigger": { "type": "time-based", "timeSeconds": 60 }
        }
      ],
      "estimatedDuration": 3
    },
    {
      "id": "step4",
      "title": "Verify Job Allocation",
      "description": "Confirm the job received the requested GPU resources by checking job details.",
      "objectives": ["Verify correct GPU allocation"],
      "expectedCommands": ["squeue", "scontrol show job"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Check job details",
          "expectedCommands": ["squeue", "scontrol show job"],
          "requireAllCommands": false
        }
      ],
      "hints": [
        "scontrol show job shows detailed allocation info including GRES"
      ],
      "enhancedHints": [
        {
          "id": "step4-hint1",
          "level": 2,
          "message": "Look for 'Gres=' in the scontrol show job output",
          "trigger": { "type": "time-based", "timeSeconds": 30 }
        }
      ],
      "estimatedDuration": 2
    }
  ],
  "successCriteria": [
    "Understood GRES configuration",
    "Verified GPU detection in Slurm",
    "Successfully submitted GPU job",
    "Verified resource allocation"
  ],
  "estimatedTime": 15,
  "prerequisites": ["domain3-slurm-config"],
  "tags": [
    "slurm",
    "gres",
    "gpu",
    "scheduling",
    "configuration",
    "intermediate",
    "domain3"
  ],
  "tier": 2,
  "commandFamilies": ["cluster-tools"],
  "explanationGateId": "gate-domain3-slurm-gres"
}
