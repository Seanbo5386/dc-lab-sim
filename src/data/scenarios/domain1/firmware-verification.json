{
  "id": "domain1-firmware-verification",
  "title": "Firmware Version Verification and Compliance",
  "domain": "domain1",
  "difficulty": "intermediate",
  "description": "Learn how to verify firmware versions across all DGX components including GPU, BMC, SBIOS, NVSwitch, and InfiniBand HCAs. Understanding firmware compliance is critical for system stability and support.",
  "learningObjectives": [
    "Check GPU firmware and driver versions",
    "Verify BMC firmware version",
    "Validate NVSwitch firmware status",
    "Check InfiniBand HCA firmware",
    "Compare versions against NVIDIA baselines",
    "Identify components requiring updates"
  ],
  "faults": [],
  "initialClusterState": {},
  "steps": [
    {
      "id": "step1",
      "title": "Check GPU Driver and VBIOS Version",
      "description": "Verify the installed NVIDIA driver version and GPU VBIOS are compatible and up-to-date.",
      "objectives": [
        "Query current driver version",
        "Check GPU VBIOS version",
        "Verify CUDA version compatibility"
      ],
      "expectedCommands": [
        "nvidia-smi",
        "nvidia-smi -q | grep -i \"vbios\\|driver\"",
        "nvidia-smi --query-gpu=driver_version,vbios_version --format=csv"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check GPU driver and VBIOS versions",
          "expectedCommands": ["nvidia-smi", "nvidia-smi -q"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvidia-smi' to see driver version in the header",
        "Use 'nvidia-smi -q' for detailed VBIOS information",
        "VBIOS version format: XX.XX.XX.XX.XX",
        "DGX A100 typically uses driver 535.x or newer",
        "DGX H100 requires driver 535.x or newer",
        "Check NVIDIA DGX Software Release Notes for baseline versions"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "NVIDIA Driver Downloads",
          "url": "https://www.nvidia.com/drivers"
        }
      ]
    },
    {
      "id": "step2",
      "title": "Verify BMC Firmware Version",
      "description": "Check the Baseboard Management Controller firmware version using IPMI commands.",
      "objectives": [
        "Query BMC firmware version",
        "Identify BMC manufacturer info",
        "Document current version for compliance"
      ],
      "expectedCommands": ["ipmitool mc info", "ipmitool bmc info"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check BMC firmware version",
          "expectedCommands": ["ipmitool mc info"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'ipmitool mc info' for Management Controller information",
        "Look for 'Firmware Revision' field",
        "BMC firmware updates are critical for security patches",
        "DGX BMC firmware version format varies by manufacturer",
        "Compare against NVIDIA's recommended baseline"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "DGX BMC Documentation",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    },
    {
      "id": "step3",
      "title": "Check NVSwitch Firmware Status",
      "description": "Verify NVSwitch firmware version and status for proper GPU interconnect operation.",
      "objectives": [
        "Query NVSwitch information",
        "Verify NVSwitch firmware version",
        "Check NVSwitch health status"
      ],
      "expectedCommands": ["nvidia-smi nvlink --status", "nvsm show nvswitch"],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check NVSwitch status",
          "expectedCommands": [
            "nvidia-smi nvlink --status",
            "nvsm show nvswitch"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "NVSwitches provide the GPU-to-GPU interconnect fabric",
        "DGX A100/H100 systems have multiple NVSwitches",
        "Use 'nvsm show nvswitch' to see NVSwitch inventory",
        "NVSwitch firmware must match GPU driver expectations",
        "Fabric Manager requires compatible NVSwitch firmware"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "NVSwitch Architecture",
          "url": "https://docs.nvidia.com/datacenter/nvlink/"
        }
      ]
    },
    {
      "id": "step4",
      "title": "Verify InfiniBand HCA Firmware",
      "description": "Check InfiniBand Host Channel Adapter firmware versions using Mellanox tools.",
      "objectives": [
        "Query HCA firmware version",
        "Check InfiniBand port status",
        "Verify firmware compatibility"
      ],
      "expectedCommands": [
        "ibstat",
        "mlxfwmanager --query",
        "mlxconfig -d /dev/mst/mt4123_pciconf0 q"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check InfiniBand firmware",
          "expectedCommands": ["ibstat", "mlxfwmanager --query"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'ibstat' to see HCA status and firmware version",
        "Use 'mlxfwmanager --query' for detailed firmware info",
        "ConnectX-6/7 requires MLNX_OFED compatible firmware",
        "Firmware version format: XX.XX.XXXX",
        "Check Mellanox firmware release notes for compatibility"
      ],
      "estimatedDuration": 7,
      "documentationLinks": [
        {
          "title": "Mellanox Firmware Tools",
          "url": "https://network.nvidia.com/products/adapter-software/firmware-tools/"
        }
      ]
    },
    {
      "id": "step5",
      "title": "Check System BIOS Version",
      "description": "Verify SBIOS version and UEFI settings that affect GPU operation.",
      "objectives": [
        "Query system BIOS version",
        "Check UEFI firmware details",
        "Verify BIOS settings are optimal"
      ],
      "expectedCommands": [
        "dmidecode -s bios-version",
        "dmidecode -t bios",
        "ipmitool fru"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must check BIOS version",
          "expectedCommands": [
            "dmidecode -s bios-version",
            "dmidecode -t bios"
          ],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'dmidecode -s bios-version' for quick version check",
        "Use 'dmidecode -t bios' for detailed BIOS information",
        "SBIOS updates may require system reboot",
        "DGX BIOS versions are released with DGX Software Stack",
        "Verify Against NVIDIA DGX OS release notes"
      ],
      "estimatedDuration": 5,
      "documentationLinks": [
        {
          "title": "DGX Software Documentation",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    },
    {
      "id": "step6",
      "title": "Generate Firmware Compliance Report",
      "description": "Create a comprehensive firmware inventory and compare against NVIDIA baselines.",
      "objectives": [
        "Collect all firmware versions",
        "Document current state",
        "Identify update requirements"
      ],
      "expectedCommands": [
        "nvsm show inventory",
        "nvidia-smi -q | head -50",
        "ipmitool fru"
      ],
      "validationRules": [
        {
          "type": "command-executed",
          "description": "Must generate firmware inventory",
          "expectedCommands": ["nvsm show inventory", "nvidia-smi -q"],
          "requireAllCommands": true
        }
      ],
      "hints": [
        "Use 'nvsm show inventory' for comprehensive system inventory",
        "Document all versions for change management",
        "Compare against DGX Software Release Notes",
        "Create baseline before any upgrades",
        "Keep firmware versions consistent across cluster nodes"
      ],
      "estimatedDuration": 8,
      "documentationLinks": [
        {
          "title": "DGX Software Releases",
          "url": "https://docs.nvidia.com/dgx/"
        }
      ]
    }
  ],
  "successCriteria": [
    "Verified GPU driver and VBIOS versions",
    "Checked BMC firmware version",
    "Validated NVSwitch firmware status",
    "Verified InfiniBand HCA firmware",
    "Checked system BIOS version",
    "Generated firmware compliance report"
  ],
  "estimatedTime": 35,
  "prerequisites": ["domain1-server-post"],
  "tags": [
    "firmware",
    "compliance",
    "verification",
    "driver",
    "bios",
    "intermediate"
  ],
  "tier": 2,
  "commandFamilies": ["gpu-monitoring", "bmc-hardware", "infiniband-tools"],
  "explanationGateId": "gate-domain1-firmware-verification"
}
