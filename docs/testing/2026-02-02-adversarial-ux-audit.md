# Adversarial UX Audit Results

**Date:** 2026-02-02
**Tests Run:** 48
**Passed:** 3 (6%)
**Failed:** 45 (94%)

## Summary

Adversarial testing reveals significant gaps in error handling across all simulators. Most commands fail silently, crash, or return incorrect responses when given invalid inputs.

---

## Priority P0 - Critical (Crashes)

| Issue | Component | Description | Fix |
|-------|-----------|-------------|-----|
| Empty command crashes | `BaseSimulator.ts:540` | `hasAnyFlag()` crashes with `Cannot read properties of undefined` when `parsed.flags` is undefined | Add null check before accessing `.has()` |
| Whitespace-only command crashes | `BaseSimulator.ts` | Same as above | Same fix |

---

## Priority P1 - High (Invalid Input Not Rejected)

### nvidia-smi (10 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| Invalid GPU index (999) | Error message | Silently fails or wrong output |
| Negative GPU index (-1) | Error message | Not validated |
| Non-numeric GPU index (abc) | Error message | Not validated |
| Extremely large index | Error message | Not validated |
| Empty string after flag | Error message | Not handled |
| Special chars in args | Error message | Not sanitized |
| Unknown flags | Usage/error | Silently ignored |
| Duplicate flags | Consistent behavior | Undefined behavior |
| Mixed valid/invalid flags | Error message | Partial execution |
| Invalid query metrics | Error message | Not validated |

### dcgmi (6 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| No subcommand | Help/usage | Unclear behavior |
| Invalid subcommand | Error message | Not validated |
| Invalid GPU group (-g 9999) | Error message | Not validated |
| Invalid diag level (-r 99) | Error message | Not validated |
| Negative group ID | Error message | Not validated |
| Invalid policy action | Error message | Not validated |

### slurm (4 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| Invalid scontrol entity | Error message | Not validated |
| Invalid state in update | Error message | Not validated |
| sbatch without script | Error message | Not validated |
| scancel with invalid ID | Error message | Not validated |

### infiniband (4 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| ibstat invalid device | Error message | Not validated |
| perfquery invalid LID | Error message | Not validated |
| ibportstate invalid port | Error message | Not validated |
| Unknown flags | Error message | Not validated |

### benchmark (6 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| nccl-test negative GPU count | Error message | Not validated |
| nccl-test zero GPUs | Error message | Not validated |
| hpl invalid problem size | Error message | Not validated |
| gpu-burn negative duration | Error message | Not validated |
| nccl-test invalid operation | Error message | Not validated |
| minbytes > maxbytes | Error message | Not validated |

### basic system (4 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| hostname invalid flag | Ignore or error | Crashes |
| cat non-existent file | "No such file" error | Not validated |
| dmesg invalid log level | Ignore or error | Crashes |
| uname multiple flags | Handle correctly | Crashes |

### fabric manager (3 issues)
| Issue | Expected | Actual |
|-------|----------|--------|
| No subcommand | Help/usage | Unclear behavior |
| Invalid query type | Error message | Not validated |
| Conflicting options | Error message | Not validated |

---

## Priority P2 - Medium (Boundary Cases)

| Issue | Expected | Actual |
|-------|----------|--------|
| GPU index 7 (last valid) | Success | Fails |
| GPU index 8 (first invalid) | Clear error | Fails |
| nccl-test -g 8 (max valid) | Success | Fails |
| nccl-test -g 1000 (way over) | Error | Fails |

---

## Recommended Fix Order

1. **Fix BaseSimulator.hasAnyFlag()** - Add null check for `parsed.flags`
   - Fixes 4+ crashes immediately

2. **Add input validation to parseCommand()**
   - Validate numeric arguments are actually numbers
   - Validate values are within acceptable ranges

3. **Add unknown flag handling to all simulators**
   - Return helpful error instead of silently ignoring

4. **Add boundary validation**
   - GPU indices: 0-7 for 8-GPU system
   - Port numbers: valid ranges
   - Message sizes: min <= max

---

## Running These Tests

```bash
npm test -- --run src/simulators/__tests__/adversarialInputs.test.ts
```

## Test File Location

`src/simulators/__tests__/adversarialInputs.test.ts`

---

*Generated by adversarial UX audit - 2026-02-02*
